{"ast":null,"code":"import _asyncToGenerator from \"/Users/dinesh/tech/angular/ai-portfolio-analyzer/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { GoogleGenerativeAI } from '@google/generative-ai'; // Updated imports\nimport { GEMINI_MODEL_NAME } from '../../constants';\nimport { environment } from \"../../environments/environment\";\nimport * as i0 from \"@angular/core\";\nexport class GeminiService {\n  constructor() {\n    // IMPORTANT: API Key handling.\n    // As per guidelines, API_KEY must be obtained exclusively from process.env.API_KEY\n    // and assumed to be pre-configured, valid, and accessible.\n    // FIX: Adhere to API key guideline, using process.env.API_KEY directly.\n    // The '!' non-null assertion is used because the guidelines state to assume the key is available and valid.\n    //if (!process.env.GOOGLE_API_KEY) {\n    // This check is a safeguard. Guidelines assume it's always present.\n    // In a real application, you might want more robust handling if this assumption could be violated.\n    console.error(\"CRITICAL: API_KEY environment variable is not set. The application may not function correctly.\");\n    // Throwing an error here would prevent the service from being created in an invalid state.\n    // However, sticking to \"assume it's pre-configured\", we proceed, but the SDK will likely fail.\n    //}\n    this.genAI = new GoogleGenerativeAI(environment.api_key);\n    this.model = this.genAI.getGenerativeModel({\n      model: GEMINI_MODEL_NAME,\n      tools: [{\n        googleSearch: {}\n      }] // Configure tools at model level\n    });\n  }\n  // FIX: Added a return type to the analyzePortfolio function.\n  _buildAnalysisPrompt(items) {\n    const portfolioDescription = items.map(item =>\n    // Corrected template literal: removed unnecessary escape for the hyphen and the trailing escaped backtick.\n    `- (${item.symbol}): ${item.allocation}% allocation`).join('\\n');\n    return `\nAnalyze the following investment portfolio and provide insights.\nThe portfolio consists of:\n${portfolioDescription}\n\nConsider factors like diversification, potential risks, sector exposure, and alignment with common investment goals (e.g., growth, income, capital preservation).\nProvide a concise summary of the analysis, highlight key observations, and suggest potential areas for improvement or consideration.\nIf possible, use Google Search for up-to-date information on the assets or market conditions if relevant to the analysis.\nPresent the analysis clearly.\n    `;\n  }\n  analyzePortfolio(items) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      if (!_this.model) {\n        // Check if the model is initialized\n        // This case should ideally not be hit if the constructor succeeds and API key is present.\n        console.error(\"Gemini AI SDK not initialized. This likely indicates an issue with API Key configuration during startup.\");\n        throw new Error(\"Gemini AI SDK not initialized. Check API Key configuration.\");\n      }\n      const prompt = _this._buildAnalysisPrompt(items);\n      try {\n        // Tools are configured at the model level in the constructor.\n        // If you need to override or specify tools per request, it would be part of a GenerateContentRequest object.\n        // For a simple string prompt with model-level tools:\n        const result = yield _this.model.generateContent(prompt);\n        const apiResponse = result.response;\n        return apiResponse;\n      } catch (error) {\n        // Specify 'any' for caught error for broader compatibility, or 'unknown' and type check\n        console.error('Error calling Gemini API:', error);\n        if (error instanceof Error) {\n          throw new Error(`Gemini API Error: \\${error.message}`);\n        }\n        throw new Error('An unknown error occurred while communicating with the Gemini API.');\n      }\n    })();\n  }\n  static {\n    this.ɵfac = function GeminiService_Factory(t) {\n      return new (t || GeminiService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: GeminiService,\n      factory: GeminiService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["GoogleGenerativeAI","GEMINI_MODEL_NAME","environment","GeminiService","constructor","console","error","genAI","api_key","model","getGenerativeModel","tools","googleSearch","_buildAnalysisPrompt","items","portfolioDescription","map","item","symbol","allocation","join","analyzePortfolio","_this","_asyncToGenerator","Error","prompt","result","generateContent","apiResponse","response","factory","ɵfac","providedIn"],"sources":["/Users/dinesh/tech/angular/ai-portfolio-analyzer/app/services/gemini.service.ts"],"sourcesContent":["\nimport { Injectable } from '@angular/core';\nimport { GenerativeModel, GoogleGenerativeAI, GenerateContentResponse } from '@google/generative-ai'; // Updated imports\nimport { PortfolioItem } from '../../types';\nimport { GEMINI_MODEL_NAME } from '../../constants';\nimport { environment } from \"../../environments/environment\"\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class GeminiService {\n  private genAI: GoogleGenerativeAI;\n  private model: GenerativeModel;\n\n  constructor() {\n    // IMPORTANT: API Key handling.\n    // As per guidelines, API_KEY must be obtained exclusively from process.env.API_KEY\n    // and assumed to be pre-configured, valid, and accessible.\n    // FIX: Adhere to API key guideline, using process.env.API_KEY directly.\n    // The '!' non-null assertion is used because the guidelines state to assume the key is available and valid.\n    //if (!process.env.GOOGLE_API_KEY) {\n    // This check is a safeguard. Guidelines assume it's always present.\n    // In a real application, you might want more robust handling if this assumption could be violated.\n    console.error(\"CRITICAL: API_KEY environment variable is not set. The application may not function correctly.\");\n    // Throwing an error here would prevent the service from being created in an invalid state.\n    // However, sticking to \"assume it's pre-configured\", we proceed, but the SDK will likely fail.\n    //}\n    this.genAI = new GoogleGenerativeAI(environment.api_key);\n    this.model = this.genAI.getGenerativeModel({\n      model: GEMINI_MODEL_NAME,\n      tools: [{ googleSearch: {} } as any], // Configure tools at model level\n    });\n  }\n  // FIX: Added a return type to the analyzePortfolio function.\n\n  private _buildAnalysisPrompt(items: PortfolioItem[]): string {\n    const portfolioDescription = items.map(item =>\n      // Corrected template literal: removed unnecessary escape for the hyphen and the trailing escaped backtick.\n      `- (${item.symbol}): ${item.allocation}% allocation`\n    ).join('\\n');\n\n    return `\nAnalyze the following investment portfolio and provide insights.\nThe portfolio consists of:\n${portfolioDescription}\n\nConsider factors like diversification, potential risks, sector exposure, and alignment with common investment goals (e.g., growth, income, capital preservation).\nProvide a concise summary of the analysis, highlight key observations, and suggest potential areas for improvement or consideration.\nIf possible, use Google Search for up-to-date information on the assets or market conditions if relevant to the analysis.\nPresent the analysis clearly.\n    `;\n  }\n\n  async analyzePortfolio(items: PortfolioItem[]): Promise<GenerateContentResponse> {\n    if (!this.model) { // Check if the model is initialized\n      // This case should ideally not be hit if the constructor succeeds and API key is present.\n      console.error(\"Gemini AI SDK not initialized. This likely indicates an issue with API Key configuration during startup.\");\n      throw new Error(\"Gemini AI SDK not initialized. Check API Key configuration.\");\n    }\n    const prompt = this._buildAnalysisPrompt(items);\n\n    try {\n      // Tools are configured at the model level in the constructor.\n      // If you need to override or specify tools per request, it would be part of a GenerateContentRequest object.\n      // For a simple string prompt with model-level tools:\n      const result = await this.model.generateContent(prompt);\n      const apiResponse = result.response;\n      return apiResponse;\n    } catch (error: any) { // Specify 'any' for caught error for broader compatibility, or 'unknown' and type check\n      console.error('Error calling Gemini API:', error);\n      if (error instanceof Error) {\n        throw new Error(`Gemini API Error: \\${error.message}`);\n      }\n      throw new Error('An unknown error occurred while communicating with the Gemini API.');\n    }\n  }\n}\n"],"mappings":";AAEA,SAA0BA,kBAAkB,QAAiC,uBAAuB,CAAC,CAAC;AAEtG,SAASC,iBAAiB,QAAQ,iBAAiB;AACnD,SAASC,WAAW,QAAQ,gCAAgC;;AAK5D,OAAM,MAAOC,aAAa;EAIxBC,YAAA;IACE;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACAC,OAAO,CAACC,KAAK,CAAC,gGAAgG,CAAC;IAC/G;IACA;IACA;IACA,IAAI,CAACC,KAAK,GAAG,IAAIP,kBAAkB,CAACE,WAAW,CAACM,OAAO,CAAC;IACxD,IAAI,CAACC,KAAK,GAAG,IAAI,CAACF,KAAK,CAACG,kBAAkB,CAAC;MACzCD,KAAK,EAAER,iBAAiB;MACxBU,KAAK,EAAE,CAAC;QAAEC,YAAY,EAAE;MAAE,CAAS,CAAC,CAAE;KACvC,CAAC;EACJ;EACA;EAEQC,oBAAoBA,CAACC,KAAsB;IACjD,MAAMC,oBAAoB,GAAGD,KAAK,CAACE,GAAG,CAACC,IAAI;IACzC;IACA,MAAMA,IAAI,CAACC,MAAM,MAAMD,IAAI,CAACE,UAAU,cAAc,CACrD,CAACC,IAAI,CAAC,IAAI,CAAC;IAEZ,OAAO;;;EAGTL,oBAAoB;;;;;;KAMjB;EACH;EAEMM,gBAAgBA,CAACP,KAAsB;IAAA,IAAAQ,KAAA;IAAA,OAAAC,iBAAA;MAC3C,IAAI,CAACD,KAAI,CAACb,KAAK,EAAE;QAAE;QACjB;QACAJ,OAAO,CAACC,KAAK,CAAC,0GAA0G,CAAC;QACzH,MAAM,IAAIkB,KAAK,CAAC,6DAA6D,CAAC;MAChF;MACA,MAAMC,MAAM,GAAGH,KAAI,CAACT,oBAAoB,CAACC,KAAK,CAAC;MAE/C,IAAI;QACF;QACA;QACA;QACA,MAAMY,MAAM,SAASJ,KAAI,CAACb,KAAK,CAACkB,eAAe,CAACF,MAAM,CAAC;QACvD,MAAMG,WAAW,GAAGF,MAAM,CAACG,QAAQ;QACnC,OAAOD,WAAW;MACpB,CAAC,CAAC,OAAOtB,KAAU,EAAE;QAAE;QACrBD,OAAO,CAACC,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;QACjD,IAAIA,KAAK,YAAYkB,KAAK,EAAE;UAC1B,MAAM,IAAIA,KAAK,CAAC,qCAAqC,CAAC;QACxD;QACA,MAAM,IAAIA,KAAK,CAAC,oEAAoE,CAAC;MACvF;IAAC;EACH;;;uBAjEWrB,aAAa;IAAA;EAAA;;;aAAbA,aAAa;MAAA2B,OAAA,EAAb3B,aAAa,CAAA4B,IAAA;MAAAC,UAAA,EAFZ;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}